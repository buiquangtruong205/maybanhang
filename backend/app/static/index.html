<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vending Machine - Qu·∫£n l√Ω</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content login-form">
            <h2>üîê ƒêƒÉng nh·∫≠p</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">M·∫≠t kh·∫©u</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">ƒêƒÉng nh·∫≠p</button>
            </form>
            <p class="register-link">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="showRegister()">ƒêƒÉng k√Ω</a></p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal" style="display:none;">
        <div class="modal-content login-form">
            <h2>üìù ƒêƒÉng k√Ω</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regUsername">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="regUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">M·∫≠t kh·∫©u</label>
                    <input type="password" id="regPassword" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">ƒêƒÉng k√Ω</button>
            </form>
            <p class="register-link"><a href="#" onclick="showLogin()">‚Üê Quay l·∫°i ƒëƒÉng nh·∫≠p</a></p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" style="display:none;">
        <nav class="navbar">
            <div class="nav-brand">üè≠ Vending Machine Manager</div>
            <div class="nav-user">
                <span id="currentUser"></span>
                <button class="btn btn-logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
            </div>
        </nav>

        <div class="container">
            <div class="tabs">
                <button class="tab active" data-tab="stats">üìä Th·ªëng k√™</button>
                <button class="tab" data-tab="machines">üè≠ M√°y b√°n h√†ng</button>
                <button class="tab" data-tab="products">üì¶ S·∫£n ph·∫©m</button>
                <button class="tab" data-tab="slots">üé∞ Khe h√†ng</button>
                <button class="tab" data-tab="orders">üìã ƒê∆°n h√†ng</button>
                <button class="tab" data-tab="transactions">üí≥ Giao d·ªãch</button>
                <button class="tab" data-tab="imports">üì• Nh·∫≠p h√†ng</button>
                <button class="tab" data-tab="devices">üîå Thi·∫øt b·ªã</button>
                <button class="tab" data-tab="security">üîí B·∫£o m·∫≠t</button>
                <button class="tab" data-tab="firmware">‚öôÔ∏è Firmware</button>
                <button class="tab" data-tab="telemetry">üì° Telemetry</button>
            </div>

            <!-- Statistics Tab -->
            <div id="stats" class="tab-content active">
                <div class="tab-header">
                    <h2>Th·ªëng k√™ t·ªïng quan</h2>
                </div>
                <div class="stats-container">
                    <div class="stat-card stat-revenue">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <span class="stat-label">Doanh thu</span>
                            <span class="stat-value" id="statRevenue">0 ‚Ç´</span>
                        </div>
                    </div>
                    <div class="stat-card stat-product">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-info">
                            <span class="stat-label">B√°n ch·∫°y nh·∫•t</span>
                            <span class="stat-value" id="statBestProduct">-</span>
                            <span class="stat-sub" id="statBestProductSold"></span>
                        </div>
                    </div>
                    <div class="stat-card stat-customer">
                        <div class="stat-icon">üë§</div>
                        <div class="stat-info">
                            <span class="stat-label">Mua nhi·ªÅu nh·∫•t</span>
                            <span class="stat-value" id="statTopCustomer">-</span>
                            <span class="stat-sub" id="statTopCustomerCount"></span>
                        </div>
                    </div>
                    <div class="stat-card stat-orders">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-info">
                            <span class="stat-label">T·ªïng ƒë∆°n h√†ng</span>
                            <span class="stat-value" id="statTotalOrders">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Machines Tab -->
            <div id="machines" class="tab-content">
                <div class="tab-header">
                    <h2>Qu·∫£n l√Ω m√°y b√°n h√†ng</h2>
                    <button class="btn btn-primary" onclick="showAddModal('machine')">+ Th√™m m√°y</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n m√°y</th>
                            <th>V·ªã tr√≠</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Secret Key</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="machinesTable"></tbody>
                </table>
            </div>

            <!-- Products Tab -->
            <div id="products" class="tab-content">
                <div class="tab-header">
                    <h2>Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
                    <button class="btn btn-primary" onclick="showAddModal('product')">+ Th√™m s·∫£n ph·∫©m</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n s·∫£n ph·∫©m</th>
                            <th>Gi√°</th>
                            <th>·∫¢nh s·∫£n ph·∫©m</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable"></tbody>
                </table>
            </div>

            <!-- Slots Tab -->
            <div id="slots" class="tab-content">
                <div class="tab-header">
                    <h2>Qu·∫£n l√Ω khe h√†ng</h2>
                    <button class="btn btn-primary" onclick="showAddModal('slot')">+ Th√™m khe</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>M√°y</th>
                            <th>M√£ khe</th>
                            <th>S·∫£n ph·∫©m</th>
                            <th>T·ªìn kho</th>
                            <th>S·ª©c ch·ª©a</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="slotsTable"></tbody>
                </table>
            </div>

            <!-- Orders Tab -->
            <div id="orders" class="tab-content">
                <div class="tab-header">
                    <h2>Danh s√°ch ƒë∆°n h√†ng</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>S·∫£n ph·∫©m</th>
                            <th>Gi√°</th>
                            <th>Khe</th>
                            <th>TT Thanh to√°n</th>
                            <th>TT Kho</th>
                            <th>Ng√†y t·∫°o</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTable"></tbody>
                </table>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content">
                <div class="tab-header">
                    <h2>Danh s√°ch giao d·ªãch</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>M√£ ƒê∆°n</th>
                            <th>S·ªë ti·ªÅn</th>
                            <th>M√£ GD Ng√¢n h√†ng</th>
                            <th>TK G·ª≠i</th>
                            <th>Ng√¢n h√†ng</th>
                            <th>M√¥ t·∫£</th>
                            <th>Tr·∫°ng th√°i</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTable"></tbody>
                </table>
            </div>

            <!-- Imports Tab -->
            <div id="imports" class="tab-content">
                <div class="tab-header">
                    <h2>L·ªãch s·ª≠ nh·∫≠p h√†ng</h2>
                    <button class="btn btn-primary" onclick="showAddModal('import')">+ Nh·∫≠p h√†ng</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>M√°y</th>
                            <th>Khe</th>
                            <th>S·∫£n ph·∫©m</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>Ng∆∞·ªùi nh·∫≠p</th>
                            <th>Ng√†y nh·∫≠p</th>
                        </tr>
                    </thead>
                    <tbody id="importsTable"></tbody>
                </table>
            </div>

            <!-- Devices Tab -->
            <div id="devices" class="tab-content">
                <div class="tab-header">
                    <h2>Qu·∫£n l√Ω thi·∫øt b·ªã IoT</h2>
                </div>
                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="switchDeviceTab('identity')">üîë ƒê·ªãnh danh</button>
                    <button class="sub-tab" onclick="switchDeviceTab('sessions')">üì° Sessions</button>
                    <button class="sub-tab" onclick="switchDeviceTab('rotations')">üîÑ Key Rotations</button>
                </div>

                <div id="device-identity" class="sub-tab-content active">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>M√°y ID</th>
                                <th>MAC Address</th>
                                <th>Fingerprint</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Ng√†y c·∫•p</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="deviceIdentityTable"></tbody>
                    </table>
                </div>

                <div id="device-sessions" class="sub-tab-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Session ID</th>
                                <th>M√°y</th>
                                <th>IP</th>
                                <th>Ph√°t h√†nh</th>
                                <th>H·∫øt h·∫°n</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="deviceSessionsTable"></tbody>
                    </table>
                </div>

                <div id="device-rotations" class="sub-tab-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>M√°y</th>
                                <th>Key c≈©</th>
                                <th>Key m·ªõi</th>
                                <th>Ng∆∞·ªùi th·ª±c hi·ªán</th>
                                <th>Ng√†y</th>
                                <th>L√Ω do</th>
                            </tr>
                        </thead>
                        <tbody id="deviceRotationsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Security Tab -->
            <div id="security" class="tab-content">
                <div class="tab-header">
                    <h2>B·∫£o m·∫≠t & Audit</h2>
                </div>
                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="switchSecurityTab('events')">‚ö†Ô∏è S·ª± ki·ªán</button>
                    <button class="sub-tab" onclick="switchSecurityTab('audit')">üìã API Logs</button>
                    <button class="sub-tab" onclick="switchSecurityTab('access')">üö™ Truy c·∫≠p</button>
                </div>

                <div id="security-events" class="sub-tab-content active">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>M√°y</th>
                                <th>Lo·∫°i</th>
                                <th>M·ª©c ƒë·ªô</th>
                                <th>Th√¥ng ƒëi·ªáp</th>
                                <th>Th·ªùi gian</th>
                                <th>ƒê√£ x·ª≠ l√Ω</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="securityEventsTable"></tbody>
                    </table>
                </div>

                <div id="security-audit" class="sub-tab-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>M√°y</th>
                                <th>Endpoint</th>
                                <th>Method</th>
                                <th>IP</th>
                                <th>Response</th>
                                <th>Signature</th>
                                <th>Th·ªùi gian</th>
                            </tr>
                        </thead>
                        <tbody id="apiAuditLogsTable"></tbody>
                    </table>
                </div>

                <div id="security-access" class="sub-tab-content">
                    <button class="btn btn-primary" onclick="showAddModal('accessLog')" style="margin-bottom: 15px;">+
                        Ghi nh·∫≠n truy c·∫≠p</button>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ng∆∞·ªùi d√πng</th>
                                <th>M√°y</th>
                                <th>H√†nh ƒë·ªông</th>
                                <th>B·∫Øt ƒë·∫ßu</th>
                                <th>K·∫øt th√∫c</th>
                                <th>Ghi ch√∫</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="accessLogsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Firmware Tab -->
            <div id="firmware" class="tab-content">
                <div class="tab-header">
                    <h2>C·∫≠p nh·∫≠t Firmware OTA</h2>
                    <button class="btn btn-primary" onclick="showAddModal('firmware')">+ T·∫°o c·∫≠p nh·∫≠t</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>M√°y</th>
                            <th>T·ª´ version</th>
                            <th>ƒê·∫øn version</th>
                            <th>Checksum</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>B·∫Øt ƒë·∫ßu</th>
                            <th>K·∫øt th√∫c</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="firmwareTable"></tbody>
                </table>
            </div>

            <!-- Telemetry Tab -->
            <div id="telemetry" class="tab-content">
                <div class="tab-header">
                    <h2>D·ªØ li·ªáu Telemetry</h2>
                    <select id="telemetryMachineFilter" onchange="loadTelemetry()">
                        <option value="">-- T·∫•t c·∫£ m√°y --</option>
                    </select>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>M√°y</th>
                            <th>Nhi·ªát ƒë·ªô</th>
                            <th>ƒê·ªô ·∫©m</th>
                            <th>ƒêi·ªán √°p</th>
                            <th>C·ª≠a m·ªü</th>
                            <th>Th·ªùi gian</th>
                        </tr>
                    </thead>
                    <tbody id="telemetryTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="formModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="formModalTitle">Th√™m m·ªõi</h2>
            <form id="dataForm">
                <div id="formFields"></div>
                <button type="submit" class="btn btn-primary btn-full">L∆∞u</button>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Image Preview Modal -->
    <div id="imagePreviewModal" onclick="closeImagePreview()">
        <img id="previewImage" src="" alt="Preview">
    </div>

    <script src="/static/app.js"></script>
</body>

</html>